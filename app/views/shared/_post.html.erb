<h2><%= post.subject %></h2>
<p>
  <%= raw post.body %>
</p>
<ul class="comments unstyled">
  <li class="count">
    <i class="icon-comments"></i> 
    <span class="count"><%= t('.comments', count: post.comments.size) %></span>
    <%= link_to raw(t('.comment')), '#', class: 'btn btn-success add-comment' %>
  </li>
  <% if allow_comments %>
  <li class="form">
    <%= simple_form_for @new_comment, url: post_comments_path(post), html: {class: 'hidden'} do |comment_form| %>
      <%= comment_form.input :body, label: t('.body'), input_html: {rows: 5} %>
      <div class="actions">
        <%= comment_form.button :submit, class: 'btn btn-success' %>
        <%= link_to t('.cancel'), '#', class: 'btn cancel' %>
      </div>
    <% end %>
  </li>
  <% end %>
  <% post.comments.each do |comment| %>
    <%= render partial: 'shared/comment', locals: { comment: comment } %>
  <% end %>
</ul>

<%= content_for :dom_ready do %>
  $('form').slideoutForm({list: $('ul.comments'), 
                          control: $('.add-comment'), 
                          cancel: $('.cancel')}).bind('newItem', function(event, item) {
                            var countElement = $(item).parents('.contained').find('.count');
                            var currentCount = parseInt(countElement.html());
                            countElement.html((currentCount + 1) + (currentCount == 0 ? ' Comment' : ' Comments'));
                          });
<% end -%>